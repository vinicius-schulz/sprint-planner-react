# Copilot Instructions

- Stack: React + Vite + TypeScript + Redux Toolkit + MUI; entry in [src/main.tsx](src/main.tsx) wraps [src/App.tsx](src/App.tsx) with theme and store.
- Run/build: `npm install`, `npm run dev`, `npm run build` (see [README.md](README.md)). No test suite present.
- State: single RTK store wiring slices in [src/app/store.ts](src/app/store.ts); preloads from localStorage and saves with 300ms debounce via [src/app/persistence.ts](src/app/persistence.ts) using key `scrum-capacity-state-v1`.
- Domain types and defaults live in [src/domain/types.ts](src/domain/types.ts) and [src/domain/constants.ts](src/domain/constants.ts); configs include SP scale, workload thresholds, default periods, and schedulingStrategy (default EDD).
- Calendar rules: [src/domain/services/capacityService.ts](src/domain/services/capacityService.ts) builds working days from `calendar.daySchedules` when present, otherwise sprint range minus weekends plus manual overrides. Day schedules are generated/edited in [src/features/sprint/SprintTab.tsx](src/features/sprint/SprintTab.tsx) using [buildDaySchedules](src/domain/services/workingCalendar.ts).
- Working hours: [computeWorkingHours](src/domain/services/capacityService.ts) sums per-day periods (or `dailyWorkHours`) and subtracts event minutes; recurring events deduct on every working day.
- Capacity: [computeMemberCapacity/computeTeamCapacity](src/domain/services/capacityService.ts) only count members whose `roleType` is in `countedMemberTypes`, applying availability %, seniority and maturity factors, and `storyPointsPerHour`.
- Scheduling: [computeTaskSchedules](src/domain/services/capacityService.ts) cleans dependencies, topologically orders tasks, and schedules minute-by-minute inside working periods. Duration = `ceil(SP/storyPointsPerHour*60)` using turbo SP when enabled. It honors per-day capacity (events + recurring + availability + factors), pushes past sprint end by appending default working days if needed, and emits errors for missing dates or cycles. Strategies: EDD, SPT, BLOCKERS, HYBRID (due + blockers + duration score). Results feed selectors consumed across UI.
- Tasks UI: [src/features/tasks/TasksTab.tsx](src/features/tasks/TasksTab.tsx) auto-recomputes schedules on changes, highlights overload using `workloadWarningOver`/`workloadErrorOver`, supports drag-and-drop reordering, turbo SP, due dates, and opens details via custom event `task-manage-open` (also fired from Gantt).
- Task details dialog: [src/features/tasks/TaskInfoDialog.tsx](src/features/tasks/TaskInfoDialog.tsx) shows per-day breakdown using `computedTimeline.detail` (capacity, events, factors, used minutes).
- Gantt: [src/components/GanttTimelineFrappe/GanttTimelineFrappe.tsx](src/components/GanttTimelineFrappe/GanttTimelineFrappe.tsx) renders Frappe Gantt from `selectTaskSchedules`, colors by assignee, and dispatches `task-manage-open` on bar click.
- Summary board: [src/components/SummaryBoard/SummaryBoard.tsx](src/components/SummaryBoard/SummaryBoard.tsx) shows working days/hours, total capacity, member count, and summed task SP filtered by counted roles.
- Events: [src/features/events/EventsTab.tsx](src/features/events/EventsTab.tsx) adds/removes events; durations accept minutes/hours/days (converted using `config.dailyWorkHours`); `recurringDaily` applies every working day.
- Team: [src/features/members/TeamTab.tsx](src/features/members/TeamTab.tsx) manages members; advanced availability converts member-specific minute events into an availability percent. Renaming members propagates to tasks via `renameAssignee`.
- Config: [src/features/config/ConfigTab.tsx](src/features/config/ConfigTab.tsx) edits `GlobalConfig` with validation (JSON for factors, parsed period strings `HH:mm-HH:mm;...`, SP scale, overload thresholds). Invalid input shows inline error.
- Sprint: [src/features/sprint/SprintTab.tsx](src/features/sprint/SprintTab.tsx) validates dates, updates sprint slice, and regenerates day schedules; allows toggling non-working per day and editing up to two periods.
- Calendar manual overrides: [src/features/calendar/NonWorkingDaysTab.tsx](src/features/calendar/NonWorkingDaysTab.tsx) marks manual non-working days and “removes” weekends from the non-working set.
- Import/Export: [src/features/importExport/ImportExportTab.tsx](src/features/importExport/ImportExportTab.tsx) exports a JSON payload with version `Calculadora de Capacidade Scrum – v1.0`; importing requires `sprint` and `globalConfig` and replaces calendar, events, members, tasks, and config slices.
- Reset workflow: [src/components/NewSchedulePanel/NewSchedulePanel.tsx](src/components/NewSchedulePanel/NewSchedulePanel.tsx) lets users reset sprint/calendar and optionally keep team, tasks (dates cleared), events, or config.
- Reporting: [src/components/ReportExport/ReportExportButton.tsx](src/components/ReportExport/ReportExportButton.tsx) builds a print-ready HTML (save as PDF) summarizing sprint, capacity, events, tasks timeline, and calendar stats.
- Persistence expectations: imported state overwrites store; new schedule resets also clear computed fields; saving is automatic—no manual persist hooks needed.
- Typing/hooks: use `useAppDispatch`/`useAppSelector` from [src/app/hooks.ts](src/app/hooks.ts) for store access; state shape matches `RootPersistedState` in [src/domain/types.ts](src/domain/types.ts).
- UX cues: overload warnings appear in TasksTab banners and row coloring; Gantt accordion defaults collapsed; SummaryBoard/Report rely on selectors—keep them in sync when adding new slices.
